location ~* ^/(?:(?<realm>api)/v1/)?(?:(?:(?:(?<resource3>[a-z0-9_-]+)/(?<slug3>[a-z0-9_-]+)/)?(?<resource2>[a-z0-9_-]+)/(?<slug2>[a-z0-9_-]+)/)?(?<resource>[a-z0-9_-]+))/(?<slug>[a-z0-9_-]+)/(?:index.(?<format>json|html?|ext.json))?$ {
  include app/mixins/upstream.conf;
  include app/mixins/redirect.conf;
  include app/mixins/input.conf;

  # Show
  postgres_query   GET :show;
  postgres_rewrite GET rows    show.html;
  postgres_rewrite GET no_rows 404;

  # Destroy
  postgres_query   DELETE :delete;
  postgres_rewrite DELETE rows    $return_path/;
  postgres_rewrite DELETE no_rows $return_path;

  # Update
  postgres_query   POST PUT :update;
  postgres_rewrite POST PUT errors    edit.html;
  postgres_rewrite POST PUT no_errors $return_path:slug/?flash=:success;

}
